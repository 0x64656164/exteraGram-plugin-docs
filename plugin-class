  Plugin Class · Документация 

Содержание
----------

*   [Обзор](#overview)
*   [Метаданные](#metadata)
*   [Жизненный цикл](#lifecycle)
*   [Hooks](#hooks)
*   [Взаимодействие с Telegram](#interfaces)

Обзор Plugin Class
==================

Все плагины должны реализовывать класс, унаследованный от `BasePlugin`. Этот класс управляет логикой, которая выполняется во время загрузки, перехвата сообщений и взаимодействия с Telegram API.

Метаданные плагина
==================

В начале каждого `.plugin` файла можно (и рекомендуется) указать метаданные:

    __min_version__ = ">=1.0.0"
    __icon__ = "sPluginIDE/0"
    

*   `__min_version__` — минимально необходимая версия среды exteraGram.
*   `__icon__` — ссылка и индекс стикера, иконка плагина в интерфейсе.

**Важно:** метаданные `__name__`, `__description__`, `__author__`, `__version__`, `__id` задаются и редактируются в редакторе версии плагина. Удалить версию можно в менеджере версий.

Методы жизненного цикла
=======================

Эти методы можно переопределить в вашем классе плагина:

*   `on_plugin_load(self)` — вызывается при загрузке плагина.
*   `on_plugin_unload(self)` — вызывается при выгрузке плагина.

Hooks: перехваты событий
========================

Плагины могут перехватывать события, например, отправку сообщений. Для этого используется `add_on_send_message_hook`:

    def on_plugin_load(self):
        self.add_on_send_message_hook()
    

Хук должен реализовывать метод:

    def on_send_message_hook(self, account: int, params: Any) -> HookResult:
        ...
    

Хуки позволяют модифицировать сообщение, блокировать отправку или продолжить без изменений. Используется объект `HookResult` с параметром `strategy`:

*   `HookStrategy.MODIFY` — изменить сообщение.
*   `HookStrategy.BLOCK` — отменить отправку.
*   `HookStrategy.CONTINUE` — ничего не делать.

Работа с Telegram-интерфейсами
==============================

Вы можете использовать доступ к Telegram API через встроенные инструменты. Например:

    self.send_message(account, peer, "Привет от плагина!")

Доступные методы:

*   `send_message` — отправка сообщения.
*   `delete_messages` — удаление сообщений.
*   `get_dialogs` — список чатов.
*   `get_me` — информация о текущем аккаунте.

Подробности доступны в соответствующих разделах API в будущем.
