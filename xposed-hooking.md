  Xposed Hooking ¬∑ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è 

–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
----------

*   [–í–≤–µ–¥–µ–Ω–∏–µ](#intro)
*   [–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏](#concepts)
*   [–ë–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤](#handler-classes)
*   [–û–±—ä–µ–∫—Ç `param`](#param-object)
*   [–ü—Ä–æ—Ü–µ—Å—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (—à–∞–≥ –∑–∞ —à–∞–≥–æ–º)](#process)
*   [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã](#examples)

–í–≤–µ–¥–µ–Ω–∏–µ
========

Xposed‚Äë—Ö—É–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –≤–∞—à–µ–º—É –ø–ª–∞–≥–∏–Ω—É –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –≤—ã–∑–æ–≤—ã –º–µ—Ç–æ–¥–æ–≤ –∏–ª–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤ –≤–Ω—É—Ç—Ä–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –º–µ–Ω—è—Ç—å –∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω—è—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é ‚Äî –º–æ—â–Ω—ã–π —Å–ø–æ—Å–æ–± –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ –Ω–∏–∑–∫–æ–º —É—Ä–æ–≤–Ω–µ.

–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏
==================

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è "hook handler" ‚Äî –∫–ª–∞—Å—Å –Ω–∞ Python, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–¥ –¥–æ, –ø–æ—Å–ª–µ –∏–ª–∏ –≤–º–µ—Å—Ç–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ –º–µ—Ç–æ–¥–∞.

–ë–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
---------------------------

*   `MethodHook` ‚Äì –∑–∞–ø—É—Å–∫ –¥–æ/–ø–æ—Å–ª–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞, –æ—Å—Ç–∞–≤–ª—è—è –µ–≥–æ –≤—ã–∑–≤–∞–Ω–Ω—ã–º.
*   `MethodReplacement` ‚Äì –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω—è–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥.

–û–±—ä–µ–∫—Ç `param`
--------------

–ü–∞—Ä–∞–º–µ—Ç—Ä `param` (XC\_MethodHook.Param) —Å–æ–¥–µ—Ä–∂–∏—Ç:

*   `param.thisObject` ‚Äî —ç–∫–∑–µ–º–ø–ª—è—Ä (None –¥–ª—è static).
*   `param.args` ‚Äî —Å–ø–∏—Å–æ–∫ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤, –º–æ–∂–Ω–æ —á–∏—Ç–∞—Ç—å –∏ –º–µ–Ω—è—Ç—å –ø–µ—Ä–µ–¥ –º–µ—Ç–æ–¥–æ–º.
*   `param.result` ‚Äî –≤–æ–∑–≤—Ä–∞—â—ë–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
*   `param.method` ‚Äî –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ —Å–∞–º–æ–≥–æ –º–µ—Ç–æ–¥–∞.
*   `param.returnEarly = True` ‚Äî –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞, –≤–µ—Ä–Ω—É–≤ `param.result` —Å—Ä–∞–∑—É.

–ü—Ä–æ—Ü–µ—Å—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (—à–∞–≥ –∑–∞ —à–∞–≥–æ–º)
----------------------------------

1.  **–ù–∞–π–¥–∏—Ç–µ –º–µ—Ç–æ–¥ –∏–ª–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä** —á–µ—Ä–µ–∑ Java reflection:
    
        from hook_utils import find_class
        ActionBar = find_class("org.telegram.ui.ActionBar.ActionBar")
        m = ActionBar.getDeclaredMethod("setTitle", find_class("java.lang.CharSequence"))
        m.setAccessible(True)
    
2.  **–°–æ–∑–¥–∞–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫**, –Ω–∞—Å–ª–µ–¥—É—è—Å—å –æ—Ç `MethodHook` –∏–ª–∏ `MethodReplacement`:
    
        class TitleLogger(MethodHook):
            def __init__(self, plugin): self.plugin = plugin
            def before_hooked_method(self, param):
                self.plugin.log(f"–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞: {param.args[0]}")
                param.args[0] = "[Hooked] " + param.args[0]
    
3.  **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ —Ö—É–∫** –≤ `on_plugin_load`:
    
        handler = TitleLogger(self)
        self.unhook = self.hook_method(m, handler, priority=10)
    
    –•—É–∫ —É–¥–∞–ª–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤—ã–≥—Ä—É–∑–∫–µ, –∏–ª–∏ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ `self.unhook_method(self.unhook)`.
    

–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã
--------------------

### 1\. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º

    class ToastHook(MethodHook):
        def before_hooked_method(self, param):
            param.args[1] = "(Plugin) " + param.args[1]

–í on\_plugin\_load:

    Toast = find_class("android.widget.Toast")
    makeText = Toast.getDeclaredMethod("makeText", find_class("android.content.Context"), find_class("java.lang.CharSequence"), jint)
    self.hook_method(makeText, ToastHook())

### 2\. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞

    class BuildVarsHook(MethodHook):
        def after_hooked_method(self, param):
            param.result = False

### 3\. –ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ –º–µ—Ç–æ–¥–∞

    class NoOpLogger(MethodReplacement):
        def replace_hooked_method(self, param):
            return None  # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ ‚Äî —á–µ—Ä–µ–∑ `self.hook_method`.

**–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ** (—É–∫–∞–∑—ã–≤–∞—Ç—å –≤ .plugin-—Ñ–∞–π–ª–µ _–º–æ–∂–Ω–æ_, –Ω–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):

    __id__ = "xposed_hook_plugin"
    __mi_version__ = ">=1.0.0"
    __icon__ = "üõ†Ô∏è"

–û—Å—Ç–∞–ª—å–Ω—ã–µ: `name`, `description`, `author`, `version` ‚Äî –∑–∞–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ —Ä–µ–¥–∞–∫—Ç–æ—Ä (—É–¥–∞–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ ‚Äî —á–µ—Ä–µ–∑ –º–µ–Ω–µ–¥–∂–µ—Ä).
